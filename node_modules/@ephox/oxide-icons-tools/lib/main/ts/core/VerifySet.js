"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.verifySet = void 0;
const chalk = require("chalk");
const log = require("fancy-log");
const Configuration_1 = require("../Configuration");
// @ts-ignore Missing typings
const esm = require("esm");
const esmRequire = esm(module);
const difference = (source, toExclude) => source.filter((value) => !toExclude.find((val) => val === value));
const produceDiff = (iconNames, defaultIconNames) => {
    const additional = difference(defaultIconNames, iconNames);
    const omitted = difference(iconNames, defaultIconNames);
    let diff = '';
    if (additional.length) {
        const additionalDiff = additional.reduce((acc, str) => acc + '\n  + ' + str, '');
        diff += chalk.green(`${additional.length} additional icon${(additional.length > 1 ? 's' : '') + additionalDiff}\n`);
    }
    if (omitted.length) {
        const omittedDiff = omitted.reduce((acc, str) => acc + '\n  - ' + str, '');
        diff += chalk.red(`${omitted.length} omitted icon${(omitted.length > 1 ? 's' : '') + omittedDiff}`);
    }
    return diff;
};
const verifySet = (svgs, diffIgnore) => {
    /* eslint-disable @typescript-eslint/no-var-requires */
    const pkg = require(Configuration_1.default.defaultIconPackage + '/package.json');
    const defaultIcons = esmRequire(Configuration_1.default.defaultIconPackage).getAll();
    const defaultIconNames = difference(Object.keys(defaultIcons), diffIgnore);
    const iconNames = difference(svgs.map((svg) => svg.name), diffIgnore);
    const diff = produceDiff(defaultIconNames, iconNames);
    if (diff.length) {
        log(`'${chalk.cyan(Configuration_1.default.pluginName)}' Displaying diff against '${pkg.name}', version: ${pkg.version} \n${diff}`);
    }
};
exports.verifySet = verifySet;
//# sourceMappingURL=VerifySet.js.map